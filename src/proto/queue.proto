syntax = "proto3";

enum Priority {
    LOW = 0;
    HIGH = 1;
}

// Puts a new message in the queue
message EnqueueRequest {
    // The actual task to enqueue
    bytes message = 1;
    // The priority of the task
    Priority priority = 2;
    // What capabilities are required to handle the task
    repeated string requiredCapabilities = 3;

    int32 refId = 4;
}

message EnqueueResponse {
    // The id of the created task
    string id = 1;

    int32 refId = 2;
}

// Removes a single message from the queue
message PopRequest {
    // What capabilities the client has available
    repeated string availableCapabilities = 1;
    // If the server should wait for a message to come in, before returning
    // with a response
    bool waitForMessage = 2;

    // An optional reference id that will be passed back with
    // the PopResponse, incase the client is multiplexing the
    // socket
    int32 refId = 3;
}

message PopResponse {
    // True if there was a message available
    bool hadResult = 3;
    // The actual message to process
    bytes message = 1;
    // The id of the message
    // Should be returned with the acknowledge request
    string id = 2;
    // The refId from the request
    int32 refId = 4;
}

message AcknowledgeRequest {
    // The id of the message to acknowledge
    string id = 1;
}

message ErrorResponse {
    string message = 1;
}

// Wraps the requests for easier parsing on the socket layer
message RequestWrapper {
    oneof message {
        EnqueueRequest enqueue = 1;
        PopRequest pop = 2;
        AcknowledgeRequest acknowledge = 3;
    }
}

message ResponseWrapper {
    oneof message {
        EnqueueResponse enqueue = 1;
        PopResponse pop = 2;
    }
}